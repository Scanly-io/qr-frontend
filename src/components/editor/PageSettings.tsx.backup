import { useState } from 'react';
import { Palette, Type, Square, ChevronDown, ChevronUp } from 'lucide-react';
import { BackgroundPicker } from './BackgroundPicker';
import { TypographySettings } from './TypographySettings';
import type { PageTheme, ButtonStyle } from '../../types/theme';

interface PageSettingsProps {
  theme: PageTheme;
  onChange: (theme: PageTheme) => void;
}

export function PageSettings({ theme, onChange }: PageSettingsProps) {
  // Track which sections are expanded (all expanded by default for easy access)
  const [expandedSections, setExpandedSections] = useState({
    background: true,
    typography: false,
    buttons: false,
  });

  const toggleSection = (section: keyof typeof expandedSections) => {
    setExpandedSections(prev => ({
      ...prev,
      [section]: !prev[section]
    }));
  };

  const updateTheme = (updates: Partial<PageTheme>) => {
    onChange({ ...theme, ...updates });
  };

  const updateButton = (updates: Partial<ButtonStyle>) => {
    updateTheme({ button: { ...theme.button, ...updates } });
  };

  return (
    <div className="space-y-3">
      {/* Background Section - Collapsible */}
      <div className="border border-border rounded-lg overflow-hidden bg-card">
        <button
          onClick={() => toggleSection('background')}
          className="w-full flex items-center justify-between p-3 hover:bg-muted/50 transition-colors"
        >
          <div className="flex items-center gap-2">
            <Palette className="w-4 h-4 text-primary" />
            <span className="font-semibold text-sm">Background</span>
          </div>
          {expandedSections.background ? (
            <ChevronUp className="w-4 h-4 text-muted-foreground" />
          ) : (
            <ChevronDown className="w-4 h-4 text-muted-foreground" />
          )}
        </button>
        {expandedSections.background && (
          <div className="p-3 pt-0 border-t border-border">
            <BackgroundPicker
              value={theme.background}
              onChange={(background) => updateTheme({ background })}
            />
          </div>
        )}
      </div>

      {/* Typography Section - Collapsible */}
      <div className="border border-border rounded-lg overflow-hidden bg-card">
        <button
          onClick={() => toggleSection('typography')}
          className="w-full flex items-center justify-between p-3 hover:bg-muted/50 transition-colors"
        >
          <div className="flex items-center gap-2">
            <Type className="w-4 h-4 text-primary" />
            <span className="font-semibold text-sm">Typography</span>
          </div>
          {expandedSections.typography ? (
            <ChevronUp className="w-4 h-4 text-muted-foreground" />
          ) : (
            <ChevronDown className="w-4 h-4 text-muted-foreground" />
          )}
        </button>
        {expandedSections.typography && (
          <div className="p-3 pt-0 border-t border-border">
            <TypographySettings
              value={theme.typography}
              onChange={(typography) => updateTheme({ typography })}
            />
          </div>
        )}
      </div>

      {/* Buttons Section - Collapsible & Compact */}
      <div className="border border-border rounded-lg overflow-hidden bg-card">
        <button
          onClick={() => toggleSection('buttons')}
          className="w-full flex items-center justify-between p-3 hover:bg-muted/50 transition-colors"
        >
          <div className="flex items-center gap-2">
            <Square className="w-4 h-4 text-primary" />
            <span className="font-semibold text-sm">Buttons</span>
          </div>
          {expandedSections.buttons ? (
            <ChevronUp className="w-4 h-4 text-muted-foreground" />
          ) : (
            <ChevronDown className="w-4 h-4 text-muted-foreground" />
          )}
        </button>
        {expandedSections.buttons && (
          <div className="p-3 pt-0 border-t border-border space-y-3">
            {/* Compact 2-column grid for button settings */}
            <div className="grid grid-cols-2 gap-3">
              {/* Size */}
              <div className="space-y-1.5">
                <label className="block text-xs font-semibold text-muted-foreground">Size</label>
                <select
                  value={theme.button.size || 'medium'}
                  onChange={(e) => updateButton({ size: e.target.value as ButtonStyle['size'] })}
                  className="w-full px-2 py-1.5 text-sm border border-border rounded bg-background"
                >
                  <option value="small">Small</option>
                  <option value="medium">Medium</option>
                  <option value="large">Large</option>
                </select>
              </div>

              {/* Variant */}
              <div className="space-y-1.5">
                <label className="block text-xs font-semibold text-muted-foreground">Style</label>
                <select
                  value={theme.button.variant || 'fill'}
                  onChange={(e) => updateButton({ variant: e.target.value as ButtonStyle['variant'] })}
                  className="w-full px-2 py-1.5 text-sm border border-border rounded bg-background"
                >
                  <option value="fill">Filled</option>
                  <option value="outline">Outline</option>
                  <option value="soft">Soft</option>
                  <option value="shadow">Shadow</option>
                </select>
              </div>

              {/* Background Color */}
              <div className="space-y-1.5">
                <label className="block text-xs font-semibold text-muted-foreground">BG Color</label>
                <div className="flex gap-1.5">
                  <input
                    type="color"
                    value={theme.button.backgroundColor || '#3b82f6'}
                    onChange={(e) => updateButton({ backgroundColor: e.target.value })}
                    className="w-10 h-8 rounded border border-border cursor-pointer"
                  />
                  <input
                    type="text"
                    value={theme.button.backgroundColor || '#3b82f6'}
                    onChange={(e) => updateButton({ backgroundColor: e.target.value })}
                    className="flex-1 px-2 py-1 text-xs border border-border rounded bg-background font-mono"
                    placeholder="#3b82f6"
                  />
                </div>
              </div>

              {/* Text Color */}
              <div className="space-y-1.5">
                <label className="block text-xs font-semibold text-muted-foreground">Text Color</label>
                <div className="flex gap-1.5">
                  <input
                    type="color"
                    value={theme.button.textColor || '#ffffff'}
                    onChange={(e) => updateButton({ textColor: e.target.value })}
                    className="w-10 h-8 rounded border border-border cursor-pointer"
                  />
                  <input
                    type="text"
                    value={theme.button.textColor || '#ffffff'}
                    onChange={(e) => updateButton({ textColor: e.target.value })}
                    className="flex-1 px-2 py-1 text-xs border border-border rounded bg-background font-mono"
                    placeholder="#ffffff"
                  />
                </div>
              </div>

              {/* Border Radius */}
              <div className="space-y-1.5">
                <label className="block text-xs font-semibold text-muted-foreground">Corners</label>
                <select
                  value={theme.button.borderRadius || 'md'}
                  onChange={(e) => updateButton({ borderRadius: e.target.value as ButtonStyle['borderRadius'] })}
                  className="w-full px-2 py-1.5 text-sm border border-border rounded bg-background"
                >
                  <option value="none">Square</option>
                  <option value="sm">Small</option>
                  <option value="md">Medium</option>
                  <option value="lg">Large</option>
                  <option value="xl">XL</option>
                  <option value="full">Pill</option>
                </select>
              </div>

              {/* Hover Effect */}
              <div className="space-y-1.5">
                <label className="block text-xs font-semibold text-muted-foreground">Hover</label>
                <select
                  value={theme.button.hoverEffect || 'lift'}
                  onChange={(e) => updateButton({ hoverEffect: e.target.value as ButtonStyle['hoverEffect'] })}
                  className="w-full px-2 py-1.5 text-sm border border-border rounded bg-background"
                >
                  <option value="none">None</option>
                  <option value="lift">Lift</option>
                  <option value="grow">Grow</option>
                  <option value="glow">Glow</option>
                  <option value="pulse">Pulse</option>
                </select>
              </div>
            </div>

            {/* Compact Button Preview */}
            <div className="p-3 bg-muted/50 rounded-lg">
              <p className="text-[10px] text-muted-foreground font-semibold uppercase tracking-wide mb-2">Preview</p>
              <div className="flex justify-center">
                <button
                  className="px-4 py-2 text-sm font-semibold transition-all duration-200"
                  style={{
                    backgroundColor: theme.button.variant === 'outline' ? 'transparent' : theme.button.backgroundColor,
                    color: theme.button.textColor,
                    borderRadius: 
                      theme.button.borderRadius === 'none' ? '0' :
                      theme.button.borderRadius === 'sm' ? '0.25rem' :
                      theme.button.borderRadius === 'md' ? '0.5rem' :
                      theme.button.borderRadius === 'lg' ? '0.75rem' :
                      theme.button.borderRadius === 'xl' ? '1rem' :
                      '9999px',
                    border: theme.button.variant === 'outline' ? `2px solid ${theme.button.backgroundColor}` : 'none',
                    boxShadow: theme.button.variant === 'shadow' ? '0 10px 25px -5px rgba(0, 0, 0, 0.1)' : 'none',
                  }}
                >
                  Click Me
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
                  </button>
                ))}
              </div>
            </div>

            <div className="space-y-3">
              <label className="block text-sm font-semibold text-foreground">Avatar Shape</label>
              <div className="grid grid-cols-3 gap-2">
                {['circle', 'square', 'rounded'].map((shape) => (
                  <button
                    key={shape}
                    onClick={() => updateHeader({ avatarShape: shape as HeaderTheme['avatarShape'] })}
                    className={`px-4 py-3 border-2 rounded-lg capitalize transition-all ${
                      theme.header.avatarShape === shape
                        ? 'border-primary bg-primary/10 text-primary font-semibold'
                        : 'border-border hover:border-primary/50'
                    }`}
                  >
                    {shape}
                  </button>
                ))}
              </div>
            </div>

            <div className="space-y-3">
              <label className="block text-sm font-semibold text-foreground">Header Options</label>
              <div className="space-y-2">
                {[
                  { key: 'showAvatar', label: 'Show Avatar' },
                  { key: 'showBio', label: 'Show Bio' },
                  { key: 'showLocation', label: 'Show Location' },
                  { key: 'showWebsite', label: 'Show Website' },
                ].map((option) => (
                  <label key={option.key} className="flex items-center gap-2">
                    <input
                      type="checkbox"
                      checked={theme.header[option.key as keyof HeaderTheme] as boolean}
                      onChange={(e) => updateHeader({ [option.key]: e.target.checked })}
                      className="w-4 h-4"
                    />
                    <span className="text-sm font-semibold text-foreground">{option.label}</span>
                  </label>
                ))}
              </div>
            </div>

            <div className="space-y-3">
              <label className="block text-sm font-semibold text-foreground">Header Alignment</label>
              <div className="grid grid-cols-3 gap-2">
                {['left', 'center', 'right'].map((align) => (
                  <button
                    key={align}
                    onClick={() => updateHeader({ alignment: align as HeaderTheme['alignment'] })}
                    className={`px-4 py-3 border-2 rounded-lg capitalize transition-all ${
                      theme.header.alignment === align
                        ? 'border-primary bg-primary/10 text-primary font-semibold'
                        : 'border-border hover:border-primary/50'
                    }`}
                  >
                    {align}
                  </button>
                ))}
              </div>
            </div>

            <div className="space-y-3">
              <label className="block text-sm font-semibold text-foreground">Header Spacing</label>
              <div className="grid grid-cols-3 gap-2">
                {['compact', 'normal', 'relaxed'].map((spacing) => (
                  <button
                    key={spacing}
                    onClick={() => updateHeader({ spacing: spacing as HeaderTheme['spacing'] })}
                    className={`px-4 py-3 border-2 rounded-lg capitalize transition-all ${
                      theme.header.spacing === spacing
                        ? 'border-primary bg-primary/10 text-primary font-semibold'
                        : 'border-border hover:border-primary/50'
                    }`}
                  >
                    {spacing}
                  </button>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Footer Settings */}
      {activeSection === 'footer' && (
        <div className="space-y-4">
          <div className="flex items-center gap-2 mb-4">
            <Layers className="w-5 h-5 text-primary" />
            <h3 className="text-lg font-bold">Footer Theme</h3>
          </div>

          <div className="space-y-4">
            <div className="space-y-3">
              <label className="block text-sm font-semibold text-foreground">Footer Style</label>
              <div className="grid grid-cols-3 gap-2">
                {['minimal', 'branded', 'social', 'detailed', 'none'].map((style) => (
                  <button
                    key={style}
                    onClick={() => updateFooter({ style: style as FooterTheme['style'] })}
                    className={`px-4 py-3 border-2 rounded-lg capitalize transition-all ${
                      theme.footer.style === style
                        ? 'border-primary bg-primary/10 text-primary font-semibold'
                        : 'border-border hover:border-primary/50'
                    }`}
                  >
                    {style}
                  </button>
                ))}
              </div>
            </div>

            {theme.footer.style !== 'none' && (
              <>
                <div className="space-y-3">
                  <label className="block text-sm font-semibold text-foreground">Footer Background</label>
                  <div className="flex gap-2">
                    <input
                      type="color"
                      value={theme.footer.backgroundColor || '#f9fafb'}
                      onChange={(e) => updateFooter({ backgroundColor: e.target.value })}
                      className="w-16 h-12 rounded-lg border-2 border-border cursor-pointer"
                    />
                    <input
                      type="text"
                      value={theme.footer.backgroundColor || ''}
                      onChange={(e) => updateFooter({ backgroundColor: e.target.value })}
                      className="flex-1 px-4 py-2 border-2 border-border rounded-lg"
                      placeholder="Leave empty for transparent"
                    />
                  </div>
                </div>

                <div className="space-y-3">
                  <label className="block text-sm font-semibold text-foreground">Footer Text Color</label>
                  <div className="flex gap-2">
                    <input
                      type="color"
                      value={theme.footer.textColor || '#6b7280'}
                      onChange={(e) => updateFooter({ textColor: e.target.value })}
                      className="w-16 h-12 rounded-lg border-2 border-border cursor-pointer"
                    />
                    <input
                      type="text"
                      value={theme.footer.textColor || '#6b7280'}
                      onChange={(e) => updateFooter({ textColor: e.target.value })}
                      className="flex-1 px-4 py-2 border-2 border-border rounded-lg"
                      placeholder="#6b7280"
                    />
                  </div>
                </div>

                <div className="space-y-3">
                  <label className="block text-sm font-semibold text-foreground">Footer Options</label>
                  <div className="space-y-2">
                    {[
                      { key: 'showBranding', label: 'Show Branding' },
                      { key: 'showSocialLinks', label: 'Show Social Links' },
                      { key: 'borderTop', label: 'Show Border Top' },
                    ].map((option) => (
                      <label key={option.key} className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={theme.footer[option.key as keyof FooterTheme] as boolean}
                          onChange={(e) => updateFooter({ [option.key]: e.target.checked })}
                          className="w-4 h-4"
                        />
                        <span className="text-sm font-semibold text-foreground">{option.label}</span>
                      </label>
                    ))}
                  </div>
                </div>

                <div className="space-y-3">
                  <label className="block text-sm font-semibold text-foreground">Custom Footer Text (Optional)</label>
                  <input
                    type="text"
                    value={theme.footer.customText || ''}
                    onChange={(e) => updateFooter({ customText: e.target.value })}
                    className="w-full px-4 py-2 border-2 border-border rounded-lg"
                    placeholder="e.g., Made with ❤️"
                  />
                </div>

                <div className="space-y-3">
                  <label className="block text-sm font-semibold text-foreground">Footer Alignment</label>
                  <div className="grid grid-cols-3 gap-2">
                    {['left', 'center', 'right'].map((align) => (
                      <button
                        key={align}
                        onClick={() => updateFooter({ alignment: align as FooterTheme['alignment'] })}
                        className={`px-4 py-3 border-2 rounded-lg capitalize transition-all ${
                          theme.footer.alignment === align
                            ? 'border-primary bg-primary/10 text-primary font-semibold'
                            : 'border-border hover:border-primary/50'
                        }`}
                      >
                        {align}
                      </button>
                    ))}
                  </div>
                </div>
              </>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
